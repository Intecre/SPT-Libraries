<?xml version="1.0" encoding="utf-8"?>
<TcPlcObject Version="1.1.0.1" ProductVersion="3.1.4024.12">
  <POU Name="T_SubModuleCollection" Id="{e452d146-811c-4c16-9bd5-d9b031d0f126}" SpecialFunc="None">
    <Declaration><![CDATA[FUNCTION_BLOCK T_SubModuleCollection EXTENDS T_CollectionBase]]></Declaration>
    <Implementation>
      <ST><![CDATA[]]></ST>
    </Implementation>
    <Method Name="AddModule" Id="{53fec14b-7f0d-4c8d-b489-4f8a2e7a91db}">
      <Declaration><![CDATA[METHOD PUBLIC AddModule : BOOL
VAR_INPUT
  newModule : I_PackML_BaseModule;
END_VAR
VAR
	item : I_InterfaceBase;
END_VAR]]></Declaration>
      <Implementation>
        <ST><![CDATA[IF newModule = 0 THEN
	LogError( 'Cannot AddModule invalid ref' );
	RETURN;
END_IF

IF NOT __QUERYINTERFACE(newModule, item) THEN
	LogError( 'Cannot AddModule  NOT __QUERYINTERFACE(newComponent, item)' );
	RETURN;
END_IF

IF HasItem( item := item ) THEN
	LogWarning( 'Module already in collection.' );
	RETURN;
END_IF

AddModule := addInSpareSlot( item := item );]]></ST>
      </Implementation>
    </Method>
    <Method Name="AllInAskedState" Id="{c5525ce9-7897-4cf9-8030-5bde5f91a91f}">
      <Declaration><![CDATA[METHOD PUBLIC AllInAskedState : BOOL
VAR_INPUT
	State : Tc3_PackML_V2.E_PMLState;
END_VAR
VAR
	i : UDINT;
	Module : I_PackML_BaseModule;
	item : I_InterfaceBase;
END_VAR ]]></Declaration>
      <Implementation>
        <ST><![CDATA[IF Count = 0 THEN
	AllInAskedState := TRUE;
	RETURN;
END_IF

FOR i := 0 TO Count -1 DO

	IF NOT 	TryGetItem(i, item => item) THEN
		RETURN;
	END_IF
	
	IF NOT __QUERYINTERFACE(item, Module) THEN
		RETURN;
	END_IF
		
	IF Module.CurrentState <> State THEN
		RETURN;
	END_IF
		
END_FOR

AllInAskedState := TRUE;]]></ST>
      </Implementation>
    </Method>
    <Property Name="AnyError" Id="{eb31021d-4235-42c3-9509-05306c59aad0}">
      <Declaration><![CDATA[PROPERTY AnyError : BOOL]]></Declaration>
      <Get Name="Get" Id="{5c9aadd3-4bed-46fd-99cb-3ec8209718e2}">
        <Declaration><![CDATA[VAR
  i : UDINT;
  Module : I_PackML_BaseModule;
  item : I_InterfaceBase;
 END_VAR ]]></Declaration>
        <Implementation>
          <ST><![CDATA[IF Count = 0 THEN
  RETURN;
END_IF

FOR i := 0 TO Count -1 DO

	IF NOT 	TryGetItem(i, item => item) THEN
		RETURN;
	END_IF
	
	IF NOT __QUERYINTERFACE(item, Module) THEN
		RETURN;
	END_IF
		
	IF Module.Error THEN
		AnyError := TRUE;
		RETURN;
	END_IF

END_FOR
]]></ST>
        </Implementation>
      </Get>
    </Property>
    <Method Name="AnyInAskedState" Id="{fd7aede1-97d0-4952-ae9a-bdb82589f7f4}">
      <Declaration><![CDATA[METHOD PUBLIC AnyInAskedState : BOOL
VAR_INPUT
	State : Tc3_PackML_V2.E_PMLState;
END_VAR
VAR_OUTPUT
	Module : I_PackML_BaseModule;	
END_VAR
VAR
	i : UDINT;

	item : I_InterfaceBase;
END_VAR ]]></Declaration>
      <Implementation>
        <ST><![CDATA[IF Count = 0 THEN
	RETURN;
END_IF

FOR i := 0 TO Count -1 DO

	IF NOT 	TryGetItem(i, item => item) THEN
		RETURN;
	END_IF
	
	IF NOT __QUERYINTERFACE(item, Module) THEN
		RETURN;
	END_IF
		
	IF Module.CurrentState = State THEN
		AnyInAskedState := TRUE;
		RETURN;
	END_IF
		
END_FOR]]></ST>
      </Implementation>
    </Method>
    <Method Name="ClearGroup" Id="{e59bb94d-6a92-4886-b69b-9d56ef4adf07}">
      <Declaration><![CDATA[METHOD PUBLIC ClearGroup // clears the group down]]></Declaration>
      <Implementation>
        <ST><![CDATA[SUPER^.ClearGroup();]]></ST>
      </Implementation>
    </Method>
    <Method Name="CyclicLogic" Id="{14da67f3-5fa4-4574-9988-115d51302eb8}">
      <Declaration><![CDATA[METHOD CyclicLogic
VAR
  i : UDINT;
  Module : I_PackML_BaseModule;
  item : I_InterfaceBase;
END_VAR]]></Declaration>
      <Implementation>
        <ST><![CDATA[IF Count = 0 THEN
  RETURN;
END_IF

FOR i := 0 TO Count -1 DO
	TryGetItem(i, item => item);
	__QUERYINTERFACE(item, Module);
	IF Module <> 0 THEN
  		Module.CyclicLogic();
	END_IF	
END_FOR]]></ST>
      </Implementation>
    </Method>
    <Property Name="InitialisedAll" Id="{cb8be73b-6402-458a-bffd-aa60da85ce4b}">
      <Declaration><![CDATA[PROPERTY PUBLIC InitialisedAll : BOOL
]]></Declaration>
      <Get Name="Get" Id="{5fb1c1d1-cf1d-4536-8532-22fb2763eeb1}">
        <Declaration><![CDATA[VAR
  i : UDINT;
  Module : I_PackML_BaseModule;
  item : I_InterfaceBase;
 END_VAR ]]></Declaration>
        <Implementation>
          <ST><![CDATA[IF Count = 0 THEN
	InitialisedAll := TRUE;
  RETURN;
END_IF

FOR i := 0 TO Count -1 DO

	IF NOT 	TryGetItem(i, item => item) THEN
		RETURN;
	END_IF
	
	IF NOT __QUERYINTERFACE(item, Module) THEN
		RETURN;
	END_IF
		
	IF NOT Module.InitComplete THEN
		RETURN;
	END_IF
		

END_FOR

InitialisedAll := TRUE;]]></ST>
        </Implementation>
      </Get>
    </Property>
    <Method Name="NotifyModeChanged" Id="{4b757abb-b5fa-4f69-8c19-ba1cf5b656bd}">
      <Declaration><![CDATA[METHOD PUBLIC NotifyModeChanged
VAR_INPUT
    Mode : E_PMLUnitMode;
END_VAR
VAR
	i : UDINT;
	Module : I_PackML_BaseModule;
	item : I_InterfaceBase;
END_VAR ]]></Declaration>
      <Implementation>
        <ST><![CDATA[IF Count = 0 THEN
  RETURN;
END_IF

FOR i := 0 TO Count -1 DO

	IF NOT 	TryGetItem(i, item => item) THEN
		RETURN;
	END_IF
	
	IF NOT __QUERYINTERFACE(item, Module) THEN
		RETURN;
	END_IF
		
	Module.ChangeMode(Mode);
		
END_FOR]]></ST>
      </Implementation>
    </Method>
    <Method Name="NotifyStateChanged" Id="{4a22e1ac-0e21-4315-95e2-0fceb8c44e5e}">
      <Declaration><![CDATA[METHOD PUBLIC NotifyStateChanged
VAR_INPUT
	CommandedState : Tc3_PackML_V2.E_PMLCommand;
END_VAR
VAR
	i : UDINT;
	Module : I_PackML_BaseModule;
	item : I_InterfaceBase;
END_VAR ]]></Declaration>
      <Implementation>
        <ST><![CDATA[IF Count = 0 THEN
  RETURN;
END_IF

FOR i := 0 TO Count -1 DO

	IF NOT 	TryGetItem(i, item => item) THEN
		RETURN;
	END_IF
	
	IF NOT __QUERYINTERFACE(item, Module) THEN
		RETURN;
	END_IF
		
	Module.ChangeState(CommandedState);
		
END_FOR]]></ST>
      </Implementation>
    </Method>
    <Method Name="SetPMLSubModuleInfoActive" Id="{d86cc83d-fd36-40fc-bc91-98090402b698}">
      <Declaration><![CDATA[METHOD PUBLIC SetPMLSubModuleInfoActive : BOOL
VAR_IN_OUT
	SubModuleInfoArray : ARRAY[*] OF ST_PMLSubUnitInfo;
END_VAR
VAR
	i : DINT;
	lowerBound, upperBound : DINT;
END_VAR]]></Declaration>
      <Implementation>
        <ST><![CDATA[lowerBound := LOWER_BOUND(SubModuleInfoArray,1);
upperBound := UPPER_BOUND(SubModuleInfoArray,1);

IF Count > upperBound THEN
	LogError('Can not SetPMLSubModuleInfoActive as  Count > upperBound');
	RETURN;
END_IF 

FOR i := lowerBound TO Count DO
    SubModuleInfoArray[i].Active := TRUE;
END_FOR;

SetPMLSubModuleInfoActive := TRUE;]]></ST>
      </Implementation>
    </Method>
    <Method Name="SetSubModuleInfoState" Id="{b0c8fd84-e58b-4bb0-93a5-199ec32b4722}">
      <Declaration><![CDATA[METHOD PUBLIC SetSubModuleInfoState
VAR_IN_OUT
	SubModuleInfoArray : ARRAY[*] OF ST_PMLSubUnitInfo;
END_VAR
VAR
	i : DINT;
	lowerBound, upperBound : DINT;
	Module : I_PackML_BaseModule;
	item : I_InterfaceBase;
END_VAR]]></Declaration>
      <Implementation>
        <ST><![CDATA[lowerBound := LOWER_BOUND(SubModuleInfoArray,1);
upperBound := UPPER_BOUND(SubModuleInfoArray,1);

IF lowerBound <> 1 THEN
	RETURN;
END_IF

IF Count > upperBound THEN
	LogError('Can not SetPMLSubModuleInfoActive as  Count > upperBound');
	RETURN;
END_IF 



FOR i := 0 TO Count -1 DO

	IF NOT 	TryGetItem(i, item => item) THEN
		RETURN;
	END_IF
	
	IF NOT __QUERYINTERFACE(item, Module) THEN
		RETURN;
	END_IF
		
	 SubModuleInfoArray[i+1].eState :=  Module.CurrentState;
		
END_FOR]]></ST>
      </Implementation>
    </Method>
    <Method Name="TryGetModule" Id="{6a10edd7-8fc0-4b22-9321-1adf10171732}">
      <Declaration><![CDATA[METHOD TryGetModule: BOOL
VAR_INPUT
	index : UDINT;
END_VAR
VAR_OUTPUT
	Module : I_PackML_BaseModule;
END_VAR
VAR
	item : I_InterfaceBase;
END_VAR]]></Declaration>
      <Implementation>
        <ST><![CDATA[IF NOT SUPER^.TryGetItem(index := index, item => item) THEN
	LogError( 'Cannot TryGetComponent NOT SUPER^.TryGetItem(index := index, item => item) ' );
	RETURN;
END_IF

IF NOT __QUERYINTERFACE(item, Module) THEN
	LogError( 'Cannot TryGetComponent   NOT __QUERYINTERFACE(item, Module) ' );
	RETURN;
END_IF

TryGetModule := Module <> 0;]]></ST>
      </Implementation>
    </Method>
    <LineIds Name="T_SubModuleCollection">
      <LineId Id="9" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.AddModule">
      <LineId Id="3" Count="3" />
      <LineId Id="17" Count="0" />
      <LineId Id="16" Count="0" />
      <LineId Id="23" Count="0" />
      <LineId Id="18" Count="1" />
      <LineId Id="7" Count="5" />
      <LineId Id="2" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.AllInAskedState">
      <LineId Id="44" Count="20" />
      <LineId Id="33" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.AnyError.Get">
      <LineId Id="5" Count="19" />
      <LineId Id="2" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.AnyInAskedState">
      <LineId Id="44" Count="0" />
      <LineId Id="46" Count="13" />
      <LineId Id="65" Count="0" />
      <LineId Id="60" Count="3" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.ClearGroup">
      <LineId Id="2" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.CyclicLogic">
      <LineId Id="9" Count="0" />
      <LineId Id="11" Count="1" />
      <LineId Id="10" Count="0" />
      <LineId Id="4" Count="0" />
      <LineId Id="16" Count="0" />
      <LineId Id="18" Count="0" />
      <LineId Id="20" Count="0" />
      <LineId Id="7" Count="0" />
      <LineId Id="21" Count="0" />
      <LineId Id="8" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.InitialisedAll.Get">
      <LineId Id="5" Count="21" />
      <LineId Id="2" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.NotifyModeChanged">
      <LineId Id="8" Count="15" />
      <LineId Id="5" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.NotifyStateChanged">
      <LineId Id="7" Count="15" />
      <LineId Id="5" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.SetPMLSubModuleInfoActive">
      <LineId Id="12" Count="1" />
      <LineId Id="16" Count="0" />
      <LineId Id="15" Count="0" />
      <LineId Id="18" Count="1" />
      <LineId Id="17" Count="0" />
      <LineId Id="9" Count="0" />
      <LineId Id="7" Count="1" />
      <LineId Id="5" Count="0" />
      <LineId Id="21" Count="0" />
      <LineId Id="20" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.SetSubModuleInfoState">
      <LineId Id="12" Count="1" />
      <LineId Id="44" Count="0" />
      <LineId Id="43" Count="0" />
      <LineId Id="45" Count="1" />
      <LineId Id="14" Count="5" />
      <LineId Id="22" Count="0" />
      <LineId Id="24" Count="0" />
      <LineId Id="28" Count="11" />
      <LineId Id="25" Count="0" />
    </LineIds>
    <LineIds Name="T_SubModuleCollection.TryGetModule">
      <LineId Id="30" Count="0" />
      <LineId Id="34" Count="0" />
      <LineId Id="32" Count="1" />
      <LineId Id="25" Count="4" />
      <LineId Id="23" Count="0" />
      <LineId Id="2" Count="0" />
    </LineIds>
  </POU>
</TcPlcObject>